package stylecode.kosta180.util;

import java.io.FileReader;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import javax.inject.Inject;
import javax.servlet.http.HttpServletRequest;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.springframework.stereotype.Component;
import org.springframework.stereotype.Repository;

import stylecode.kosta180.domain.CrollProductVO;
import stylecode.kosta180.domain.CrollSPMVO;
import stylecode.kosta180.service.CrollServiceImpl;

@Repository
public class CrollStyleInfo {
	
	@Inject
	CrollServiceImpl service = new CrollServiceImpl();
	
	public void crollInfo(){	
		JSONParser parser = new JSONParser();
		
		//쇼핑몰 목록을 담기위한 리스트
		List<CrollSPMVO> crollSPMList = new ArrayList<CrollSPMVO>();
		List<CrollProductVO> crollProductList = new ArrayList<CrollProductVO>();
		
		//쇼핑몰 크롤링.
		try {
			Object shopListobj = parser.parse(new FileReader("C:\\json\\shopList.json")); 
			Object prodListobj = parser.parse(new FileReader("C:\\json\\prodList.json")); 
			
			JSONArray shopListJsonArray = (JSONArray) shopListobj;
			JSONArray prodListJsonArray = (JSONArray) prodListobj;
			
			Iterator shopListIT = shopListJsonArray.iterator();
			Iterator prodListIT = prodListJsonArray.iterator();

			while(shopListIT.hasNext()){
				//JSON Array에서 JSONObject를 가져옴.
				JSONObject shopObj = (JSONObject) shopListIT.next();
				CrollSPMVO spmVO = new CrollSPMVO();

				int spmEnrollNo = Math.toIntExact((long) shopObj.get("shopSeq")); //쇼핑몰 등록번호
				String spmNm = (String) shopObj.get("shopName"); //쇼핑몰명
				String spmURL = (String) shopObj.get("webUrl"); //쇼핑몰URL
				String spmInfo = (String) shopObj.get("shopDescription"); //쇼핑몰 INFO
				String spmAges = (String) shopObj.get("ageNames"); //쇼핑몰 나이대
				String spmClassifCn = (String) shopObj.get("cateNames"); //쇼핑몰 스타일
				
				spmVO.setSpmEnrollNo(spmEnrollNo);
				spmVO.setSpmNm(spmNm);
				spmVO.setSpmURL(spmURL);
				spmVO.setSpmInfo(spmInfo);
				spmVO.setSpmClassifCn(spmClassifCn);
				
				crollSPMList.add(spmVO);
			}
			
			while(prodListIT.hasNext()){
				//JSON Array에서 JSONObject를 가져옴.
				JSONObject prodObj = (JSONObject) prodListIT.next();
				CrollProductVO prodVO = new CrollProductVO();
				
				long pEnrollNo = (long) prodObj.get("rowNumber"); //상품번호
				String productName = (String) prodObj.get("prodName"); //상품명
				String productImgURL =  "http://www.sta1.com" + (String) prodObj.get("webImgPath"); //상품사진URL
				String productURL = "http://www.sta1.com/cp/"
										  + prodObj.get("shopSeq") + "/" + prodObj.get("prodSeq"); //상품URL
				int productPrice = Math.toIntExact((long) prodObj.get("dcPrice")); //상품가격
				int cateSeq = Math.toIntExact((long) prodObj.get("cateSeq")); //카테고리 분류번호
				int spmEnrollNo = Math.toIntExact((long) prodObj.get("shopSeq")); //쇼핑몰 등록번호
				

				//				String category; //카테고리
				//				
				//				if(cateSeq == 101){
				//					category = "아우터";
				//				} else if(cateSeq == 102) {
				//					category = "상의";
				//				} else if(cateSeq == 103) {
				//					category = "하의";
				//				} else if(cateSeq == 104) {
				//					category = "원피스";
				//				} else if(cateSeq == 105) {
				//					category = "슈즈";
				//				} else {
				//					category = "기타";
				//				} 
				
				prodVO.setpEnrollNo(pEnrollNo);
				prodVO.setpNm(productName);
				prodVO.setpImg(productImgURL);
				prodVO.setProdURL(productURL);
				prodVO.setmPrice(productPrice);
				prodVO.setCgNo(cateSeq);
				prodVO.setSpmEnrollNo(spmEnrollNo);
				
				crollProductList.add(prodVO);
			}
			
			service.insertShopDataService(crollSPMList); //쇼핑몰 리스트
			
			service.insertProductDataService(crollProductList); //상품 리스트
			
				
		} catch (Exception e) {
			e.printStackTrace();
		}
		 
	 }//end of crollInfo()

}
