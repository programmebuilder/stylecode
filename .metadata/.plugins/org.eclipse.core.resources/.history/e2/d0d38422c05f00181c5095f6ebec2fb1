<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="stylecode.kosta180.mapper.shoppingmallMapper">
	<!-- 처음/검색 시 리스트 -->
	<select id="listShoppingMall" resultType="ShoppingmallVO" parameterType="ShoppingMallSearchVO">
	SELECT	*
	FROM	SPM
  	<if test="searchKey!=null">
		<where>
			 spmNm LIKE '%'|| #{searchKey} ||'%'
		</where>
	</if> 
	ORDER BY	spmViews desc 
	</select>
	
<!-- 	<select id="SpmStyle" parameterType="int" resultType="String">
		Select STYLE from SPMStyle
		 WHERE SPMENROLLNO = #{SPMENROLLNO}
	</select>
	
	페이징 처리
	<select id="getListCount" resultType="int" parameterType="ShoppingMallSearch">
	SELECT count(*)
		FROM SPM
	<if test="searchKey!=null">
		<where>
			spmNm LIKE #{searchKey}
		</where>
	</if>
	</select>-->
	
	<!-- 필터 시 리스트 -->
<!-- 	<select id="listShoppingMallFilter" resultType="ShoppingMall" parameterType="SpmFilterList">
		SELECT distinct sp.spmNm, sp.spmInfo, sp.spmEnrollNo, sp.spmTn
			FROM SPM sp, SPMSTYLE st
		WHERE sp.spmEnrollNo=st.spmEnrollNo AND
		<foreach collection="filterList" item="item" separator="OR">
				sp.spmEnrollNo=${item}
		</foreach>
	</select> -->
	
	<!-- 쇼핑몰 필터 -->
	<select id="spmFilter" parameterType="SpmFilter" resultType="Integer">

		SELECT DISTINCT spm.SPMENROLLNO FROM SPM
		 INNER JOIN SPMSTYLE st ON SPM.SPMENROLLNO=st.SPMENROLLNO
		 WHERE SPMCLASSIFCN = #{category}
		<if test="age != null || style != null">			
			AND(
			<choose>

				필터 항목이 두개 다 일 때
				<when test="age != null and style != null"> 
					<foreach collection="age" item="item" separator="OR">
						SPMAGES = #{item} 
					</foreach>				
					OR
					<foreach collection="style" item="item" separator="OR">
						STYLE = #{item} 
					</foreach>
				
				</when>
				
				필터 항목이 하나만 있을 때
				<otherwise>

					<if test="age != null">					
						<foreach collection="age" item="item" separator="OR">
							SPMAGES = #{item} 
						</foreach>
					</if>
					<if test="style != null">					
						<foreach collection="style" item="item" separator="OR">
							STYLE = #{item} 
						</foreach>
					</if>
				</otherwise>
			</choose>
			) age와 style 괄호로 묶어서 처리

		</if>
	</select>
	
<!--	<update id="hitCount" parameterType="int">
        UPDATE   SPM
         SET      SPMVIEWS=SPMVIEWS+1 
         WHERE   SPMENROLLNO=#{SPMENROLLNO}
    </update>  -->
</mapper>